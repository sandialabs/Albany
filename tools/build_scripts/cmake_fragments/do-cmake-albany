#! /bin/bash -xe

/bin/rm -f CMakeCache.txt

SOURCE_DIR=${ALBDIR:-..}

if [ ${ALBANY_CISM_INTERFACE:-OFF} = "ON" ]
then
    ALBANY_CISM_ARGS="-D ENABLE_CISM_INTERFACE:BOOL=ON \
                      -D CISM_INCLUDE_DIR:STRING=${CISMDIR:?CISMDIR must be defined}/include"
fi

if [ ${ALBANY_MPAS_INTERFACE:-OFF} = "ON" ]
then
    ALBANY_MPAS_ARGS="-D ENABLE_MPAS_INTERFACE:BOOL=ON \
                      -D MPAS_INCLUDE_DIR:STRING=${MPASDIR:?MPASDIR must be defined}/include"
fi

cmake \
    -D ALBANY_TRILINOS_DIR:FILEPATH=${TRILINSTALLDIR:?TRILINSTALLDIR must be set} \
    -D CMAKE_BUILD_TYPE:STRING=$ALBANY_BUILD_MODE \
    -D CMAKE_VERBOSE_MAKEFILE:BOOL=${ALBANY_VERBOSE_MAKEFILE:-OFF} \
    -D ALBANY_CXX_FLAGS:STRING="$ALBANY_CXX_FLAGS" \
\
    -D ENABLE_ALBANY_EPETRA:BOOL=${ALBANY_DISABLE_EPETRA:-ON} \
    -D ENABLE_DEMO_PDES:BOOL=${ALBANY_DISABLE_DEMO_PDES:-ON} \
\
    -D ENABLE_LANDICE:BOOL=${ALBANY_LANDICE:-OFF} \
    -D ENABLE_64BIT_INT:BOOL=${ALBANY_64BIT_INT:-OFF} \
    -D ENABLE_FAST_LANDICE:BOOL=${ALBANY_FAST_LANDICE:-OFF} \
    -D ENABLE_CHECK_FPE:BOOL=${ALBANY_CHECK_FPE:-OFF} \
    -D ENABLE_ALBANY_VERBOSE:BOOL=${ALBANY_VERBOSE:-OFF} \
    -D ENABLE_DEBUGGING:BOOL=${ALBANY_DEBUGGING:-OFF} \
    $ALBANY_CISM_ARGS \
    $ALBANY_MPAS_ARGS \
    $SOURCE_DIR
